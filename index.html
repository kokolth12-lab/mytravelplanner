<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700;800;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <title>é—œè¥¿å†¬æ—¥å¤¢å¹»æ‰‹æœ­ | 2026 å†’éšªèªŒ</title>
    <style>
        :root {
            --bg-main: #F4FBFF;
            --magic-blue: #0ea5e9;
            --magic-pink: #ec4899;
            --magic-purple: #8b5cf6;
            --magic-teal: #14b8a6;
            --magic-yellow: #f59e0b;
            --dark-border: #1e293b;
            --pass-theme: #6366f1;
        }

        body {
            font-family: 'Lexend', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f5f9ff 50%, #fce7f3 100%);
            min-height: 100vh;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* --- 3D è³ªæ„Ÿæ¨£å¼ --- */
        .btn-style {
            border: 2px solid var(--dark-border);
            border-bottom-width: 5px;
            transition: all 0.1s ease;
            border-radius: 50px;
        }
        .btn-style:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }
        .card { background: white; border: 2px solid var(--dark-border); border-bottom-width: 6px; border-radius: 24px; }

        /* --- è¼‰å…¥å‹•ç•« --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.8s;
        }

        /* --- è¡Œç¨‹æ¨¡çµ„ --- */
        .timeline-container { position: relative; padding-left: 45px; margin-top: 20px; }
        .timeline-container::before { content: ''; position: absolute; left: 18px; top: 0; bottom: 0; width: 4px; background: var(--dark-border); }
        .activity-sticker { background: #fff; border: 3px solid var(--dark-border); border-bottom-width: 8px; border-radius: 20px; padding: 15px; margin-bottom: 20px; position: relative; }

        /* --- å½ˆå‡ºå±¤ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(8px);
            z-index: 3000; justify-content: center; align-items: center;
        }
        .modal-content-base {
            width: 90vw; max-width: 800px; height: 85vh; background: #fff; border-radius: 30px;
            border: 4px solid var(--dark-border); display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- æ‹ç«‹å¾— --- */
        .polaroid-frame {
            background: white; padding: 10px 10px 30px 10px; border: 1px solid #ddd;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1); transform: rotate(-2deg); transition: 0.3s;
        }
        .polaroid-frame:hover { transform: rotate(0deg) scale(1.05); }
        .polaroid-img { width: 100%; height: 150px; object-fit: cover; border-radius: 2px; }

        /* é€šç”¨é¡ */
        .hidden { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="text-4xl animate-bounce">âœˆï¸</div>
        <div class="mt-4 font-black text-slate-400 tracking-widest uppercase text-xs">Loading Adventure...</div>
    </div>

    <div id="main-app-container" class="opacity-0 transition-opacity duration-1000 max-w-4xl mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-black text-slate-800 italic uppercase tracking-tighter">âœ¨ Osaka 2026 âœ¨</h1>
            <p class="text-slate-400 font-bold text-[10px] mt-2 tracking-[0.5em]">WINTER DREAM DIARY</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <aside class="md:col-span-1">
                <div class="card p-6 sticky top-6 bg-indigo-50 border-indigo-200">
                    <span class="bg-indigo-600 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase">Travel Pass</span>
                    <h2 id="main-trip-title" contenteditable="true" class="text-xl font-black mt-4 mb-2">é—œè¥¿å†¬æ—¥å¤¢å¹»æ‰‹æœ­ â„ï¸</h2>
                    <div class="space-y-3 mt-4">
                        <div class="bg-white p-3 rounded-xl border-2 border-slate-800" onclick="openModal('itinerary-modal')">
                            <label class="text-[8px] font-black text-slate-400 block uppercase">Dates</label>
                            <div id="main-trip-date" contenteditable="true" class="text-xs font-bold">2026/01/08 - 01/14</div>
                        </div>
                        <div class="bg-white p-3 rounded-xl border-2 border-slate-800">
                            <label class="text-[8px] font-black text-slate-400 block uppercase">Budget Status</label>
                            <div class="text-xs font-bold text-pink-500">HK$ <span id="summary-total-cost">0</span></div>
                        </div>
                    </div>
                    <button onclick="saveBasicInfo()" class="btn-style w-full mt-6 py-3 bg-slate-800 text-white text-xs font-black uppercase tracking-widest">ğŸ’¾ Save Changes</button>
                </div>
            </aside>

            <main class="md:col-span-2 grid grid-cols-2 gap-4">
                <div class="card p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-pink-50 transition btn-style" onclick="openModal('itinerary-modal')">
                    <span class="text-3xl mb-2">ğŸ—“ï¸</span>
                    <span class="font-black text-sm">è¡Œç¨‹è¦åŠƒ</span>
                </div>
                <div class="card p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-green-50 transition btn-style" onclick="openModal('money-modal')">
                    <span class="text-3xl mb-2">ğŸ’°</span>
                    <span class="font-black text-sm">æ—…è²»è¨˜å¸³</span>
                </div>
                <div class="card p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-blue-50 transition btn-style" onclick="openModal('shopping-modal')">
                    <span class="text-3xl mb-2">ğŸ›ï¸</span>
                    <span class="font-black text-sm">è³¼ç‰©æ¸…å–®</span>
                </div>
                <div class="card p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-purple-50 transition btn-style" onclick="openModal('mood-modal')">
                    <span class="text-3xl mb-2">ğŸ’–</span>
                    <span class="font-black text-sm">å¿ƒæƒ…éš¨ç­†</span>
                </div>
            </main>
        </div>
    </div>

    <div id="modal-container" class="modal-overlay" onclick="handleOverlayClick(event)">
        
        <div id="money-modal" class="hidden modal-content-base">
            <div class="p-6 border-b-4 border-slate-800 bg-green-100 flex justify-between items-center">
                <h2 class="text-2xl font-black italic">EXPENSES ğŸ’°</h2>
                <button onclick="closeModal()" class="btn-style bg-white w-10 h-10 flex items-center justify-center font-bold">âœ•</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-1 gap-4 mb-8 bg-slate-50 p-4 rounded-3xl border-2 border-slate-800">
                    <div class="flex gap-2">
                        <input type="number" id="exp-amount" placeholder="æ—¥åœ“ JPY" class="flex-1 p-3 rounded-xl border-2 border-slate-800 font-bold">
                        <input type="text" id="exp-note" placeholder="é …ç›®å…§å®¹..." class="flex-1 p-3 rounded-xl border-2 border-slate-800 font-bold">
                        <button onclick="addExpense()" class="btn-style bg-slate-800 text-white px-6 font-black">ï¼‹</button>
                    </div>
                </div>
                <div id="expense-list" class="space-y-3">
                    </div>
            </div>
            <div class="p-4 bg-slate-800 text-white flex justify-between items-center px-8">
                <span class="font-black text-xs uppercase tracking-widest">Grand Total</span>
                <span class="text-xl font-black">HK$ <span id="modal-total-hkd">0</span></span>
            </div>
        </div>

        <div id="itinerary-modal" class="hidden modal-content-base">
            <div class="p-6 border-b-4 border-slate-800 bg-yellow-100 flex justify-between items-center">
                <h2 class="text-2xl font-black italic">ITINERARY ğŸ—“ï¸</h2>
                <div class="flex gap-2">
                    <button onclick="saveItinerary()" class="btn-style bg-white px-4 py-2 text-xs font-black">ğŸ’¾ SAVE</button>
                    <button onclick="closeModal()" class="btn-style bg-white w-10 h-10 flex items-center justify-center font-bold">âœ•</button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div id="itinerary-list" class="timeline-container">
                    </div>
                <button onclick="addItineraryBlock()" class="w-full py-4 mt-4 border-4 border-dashed border-slate-300 rounded-3xl text-slate-400 font-black hover:bg-slate-50 transition">ï¼‹ æ–°å¢è¡Œç¨‹æ™‚æ®µ</button>
            </div>
        </div>

        <div id="shopping-modal" class="hidden modal-content-base">
            <div class="p-6 border-b-4 border-slate-800 bg-blue-100 flex justify-between items-center">
                <h2 class="text-2xl font-black italic">SHOPPING ğŸ›ï¸</h2>
                <button onclick="closeModal()" class="btn-style bg-white w-10 h-10 flex items-center justify-center font-bold">âœ•</button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div class="flex gap-2 mb-6">
                    <input type="text" id="shop-input" class="flex-1 p-4 border-2 border-slate-800 rounded-2xl font-bold" placeholder="æƒ³è¦è²·çš„æ±è¥¿...">
                    <button onclick="addShopItem()" class="btn-style bg-blue-500 text-white px-8 font-black uppercase">Add</button>
                </div>
                <div id="shop-list" class="space-y-3"></div>
            </div>
        </div>

    </div>

    <script>
        const RATE_HKD = 0.051; // åŒ¯ç‡è¨­å®š

        // --- åˆå§‹åŒ–èˆ‡è¼‰å…¥ ---
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('main-app-container').classList.remove('opacity-0');
                }, 800);
            }, 1000);

            loadAllData();
        };

        function loadAllData() {
            // åŸºæœ¬è³‡æ–™
            if(localStorage.getItem('trip-title')) document.getElementById('main-trip-title').innerText = localStorage.getItem('trip-title');
            if(localStorage.getItem('trip-date')) document.getElementById('main-trip-date').innerText = localStorage.getItem('trip-date');
            
            renderExpenses();
            renderShopList();
            renderItinerary();
        }

        // --- é€šç”¨å½ˆçª—æ§åˆ¶ ---
        function openModal(id) {
            document.getElementById('modal-container').style.display = 'flex';
            const targets = document.querySelectorAll('#modal-container > div');
            targets.forEach(t => t.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-container').style.display = 'none';
        }

        function handleOverlayClick(e) {
            if(e.target.id === 'modal-container') closeModal();
        }

        // --- è¨˜å¸³é‚è¼¯ ---
        function addExpense() {
            const amt = document.getElementById('exp-amount').value;
            const note = document.getElementById('exp-note').value;
            if(!amt || !note) return;

            const items = JSON.parse(localStorage.getItem('trip-expenses') || '[]');
            items.push({ id: Date.now(), jpy: amt, hkd: (amt * RATE_HKD).toFixed(2), note: note });
            localStorage.setItem('trip-expenses', JSON.stringify(items));
            
            document.getElementById('exp-amount').value = '';
            document.getElementById('exp-note').value = '';
            renderExpenses();
        }

        function renderExpenses() {
            const items = JSON.parse(localStorage.getItem('trip-expenses') || '[]');
            const list = document.getElementById('expense-list');
            let total = 0;
            list.innerHTML = '';
            
            items.forEach(item => {
                total += parseFloat(item.hkd);
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-4 bg-white border-2 border-slate-800 rounded-2xl shadow-sm";
                div.innerHTML = `
                    <div class="flex-1 font-bold text-sm">${item.note}</div>
                    <div class="text-right">
                        <div class="font-black text-xs">Â¥${item.jpy}</div>
                        <div class="text-pink-500 font-black text-[10px]">HK$ ${item.hkd}</div>
                    </div>
                    <button onclick="deleteExpense(${item.id})" class="ml-4 text-slate-300 hover:text-red-500">âœ•</button>
                `;
                list.appendChild(div);
            });

            document.getElementById('summary-total-cost').innerText = total.toFixed(0);
            document.getElementById('modal-total-hkd').innerText = total.toFixed(2);
        }

        function deleteExpense(id) {
            let items = JSON.parse(localStorage.getItem('trip-expenses') || '[]');
            items = items.filter(i => i.id !== id);
            localStorage.setItem('trip-expenses', JSON.stringify(items));
            renderExpenses();
        }

        // --- è³¼ç‰©æ¸…å–® ---
        function addShopItem() {
            const val = document.getElementById('shop-input').value;
            if(!val) return;
            const items = JSON.parse(localStorage.getItem('trip-shops') || '[]');
            items.push({ id: Date.now(), text: val, bought: false });
            localStorage.setItem('trip-shops', JSON.stringify(items));
            document.getElementById('shop-input').value = '';
            renderShopList();
        }

        function renderShopList() {
            const items = JSON.parse(localStorage.getItem('trip-shops') || '[]');
            const list = document.getElementById('shop-list');
            list.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center gap-3 p-4 bg-white border-2 border-slate-800 rounded-2xl ${item.bought ? 'opacity-40' : ''}`;
                div.innerHTML = `
                    <div onclick="toggleShop(${item.id})" class="w-6 h-6 border-2 border-slate-800 rounded flex items-center justify-center font-black cursor-pointer bg-white">
                        ${item.bought ? 'âœ“' : ''}
                    </div>
                    <div class="flex-1 font-bold text-sm ${item.bought ? 'line-through' : ''}">${item.text}</div>
                    <button onclick="deleteShop(${item.id})" class="text-slate-300">âœ•</button>
                `;
                list.appendChild(div);
            });
        }

        function toggleShop(id) {
            let items = JSON.parse(localStorage.getItem('trip-shops') || '[]');
            const idx = items.findIndex(i => i.id === id);
            items[idx].bought = !items[idx].bought;
            localStorage.setItem('trip-shops', JSON.stringify(items));
            renderShopList();
        }

        function deleteShop(id) {
            let items = JSON.parse(localStorage.getItem('trip-shops') || '[]');
            items = items.filter(i => i.id !== id);
            localStorage.setItem('trip-shops', JSON.stringify(items));
            renderShopList();
        }

        // --- è¡Œç¨‹è¦åŠƒ ---
        function addItineraryBlock(data = {time: '09:00', title: 'æ–°çš„ç›®çš„åœ°'}) {
            const list = document.getElementById('itinerary-list');
            const div = document.createElement('div');
            div.className = "activity-sticker group";
            div.innerHTML = `
                <div class="flex items-center gap-3">
                    <input type="text" value="${data.time}" class="item-time w-20 bg-slate-800 text-white rounded-full px-3 py-1 text-[10px] font-black border-none">
                    <div contenteditable="true" class="item-title flex-1 font-black text-slate-800 outline-none">${data.title}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-slate-200 hover:text-red-500">âœ•</button>
                </div>
            `;
            list.appendChild(div);
        }

        function saveItinerary() {
            const blocks = [];
            document.querySelectorAll('.activity-sticker').forEach(el => {
                blocks.push({
                    time: el.querySelector('.item-time').value,
                    title: el.querySelector('.item-title').innerText
                });
            });
            localStorage.setItem('trip-itinerary', JSON.stringify(blocks));
            alert('è¡Œç¨‹å·²å„²å­˜ âœ¨');
        }

        function renderItinerary() {
            const blocks = JSON.parse(localStorage.getItem('trip-itinerary') || '[]');
            const list = document.getElementById('itinerary-list');
            list.innerHTML = '';
            if(blocks.length === 0) {
                addItineraryBlock({time: '08:30', title: 'é—œè¥¿æ©Ÿå ´å‡ºç™¼'});
            } else {
                blocks.forEach(b => addItineraryBlock(b));
            }
        }

        // --- åŸºæœ¬è³‡æ–™å„²å­˜ ---
        function saveBasicInfo() {
            localStorage.setItem('trip-title', document.getElementById('main-trip-title').innerText);
            localStorage.setItem('trip-date', document.getElementById('main-trip-date').innerText);
            alert('åŸºæœ¬è³‡æ–™å·²æ›´æ–° âœ¨');
        }
    </script>
</body>
</html>